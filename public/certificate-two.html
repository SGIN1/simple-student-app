<!DOCTYPE html>
<html lang="ar" style="height: 100%;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=0.1">
    <title>الشهادة</title>
    <style>
        body {
            margin: 0px;
            height: 100%;
            background-color: rgb(14, 14, 14);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #certificate-container {
            background-color: hsl(0, 0%, 90%);
            transition: background-color 300ms;
            width: 496px;
            height: 607px;
            position: relative; /* لجعل العناصر الداخلية ذات موضع مطلق بالنسبة له */
        }
        #certificate-image {
            display: block;
            -webkit-user-select: none;
            margin: auto;
            cursor: zoom-in;
            width: 100%;
            height: 100%;
            object-fit: contain; /* احتواء الصورة داخل الحاوية */
        }
        .student-name {
            font-family: 'ArabicFont', serif;
            font-size: 48px;
            color: #fff;
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 90%;
        }
        .serial-number {
            font-family: sans-serif;
            font-size: 28px;
            font-weight: bold;
            color: #fff;
            position: absolute;
            top: 180px;
            left: 50px;
            text-align: center;
            width: 180px;
        }
    </style>
</head>
<body style="margin: 0px; height: 100%; background-color: rgb(14, 14, 14);">
    <div id="certificate-container">
        <img id="certificate-image" src="/public/images_temp/wwee.jpg" alt="الشهادة">
        <div id="student-name" class="student-name"></div>
        <div id="serial-number" class="serial-number"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const certificateContainer = document.getElementById('certificate-container');
            const studentNameElement = document.getElementById('student-name');
            const serialNumberElement = document.getElementById('serial-number');
            const certificateImage = document.getElementById('certificate-image');

            // دالة لاستخراج مُعرّف الطالب من مسار URL
            function getStudentIdFromUrl() {
                const pathSegments = window.location.pathname.split('/');
                // نتوقع أن يكون المعرف هو الجزء الثالث من المسار (/certificate-two/{studentId})
                return pathSegments[2];
            }

            const studentId = getStudentIdFromUrl();

            if (studentId) {
                // إرسال طلب إلى وظيفة Netlify للحصول على بيانات الشهادة
                fetch(`/.netlify/functions/generateCertificateTwo2?id=${studentId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        studentNameElement.textContent = data.arabic_name || '';
                        serialNumberElement.textContent = data.serial_number || '';
                        // يمكنك هنا تحديث أي عناصر HTML أخرى بناءً على البيانات المسترجعة
                    })
                    .catch(error => {
                        console.error('Fetch error:', error);
                        certificateContainer.innerHTML = '<h1>حدث خطأ في عرض الشهادة</h1><p>' + error.message + '</p>';
                    });
            } else {
                certificateContainer.innerHTML = '<h1>لم يتم العثور على مُعرّف الطالب في الرابط</h1>';
            }
        });
    </script>
</body>
</html>